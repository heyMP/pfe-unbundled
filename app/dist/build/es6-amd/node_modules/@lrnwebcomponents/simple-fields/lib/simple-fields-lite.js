define(["exports","require","../../../lit-element/lit-element.js","./simple-fields-container.js","./simple-fields-fieldset.js","./simple-fields-array.js"],(function(_exports,_require,_litElement,_simpleFieldsContainer,_simpleFieldsFieldset,_simpleFieldsArray){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.SimpleFieldsLite=void 0,_require=babelHelpers.interopRequireWildcard(_require);
/**
   * Copyright 2019 The Pennsylvania State University
   * @license Apache-2.0, see License.md for full text.
   */
class SimpleFieldsLite extends _litElement.LitElement{static get styles(){return[_litElement.css`
        :host {
          display: block;
          font-family: var(--simple-fields-font-family, sans-serif);
          font-family: var(--simple-fields-detail-font-family, sans-serif);
          font-size: var(--simple-fields-font-size, 16px);
          font-size: var(--simple-fields-detail-font-size, 12px);
          background: var(--simple-fields-background-color, white);
        }
        :host([hidden]) {
          display: none;
        }
      `]}render(){return _litElement.html`
      <div id="schema-fields" aria-live="polite">
        <slot></slot>
      </div>
    `}static get properties(){return{...super.properties,disableAutofocus:{type:Boolean},error:{type:Object},language:{type:String,attribute:"lang",reflect:!0},resources:{type:Object},schema:{type:Object},elementizer:{type:Object,attribute:"elementizer",reflect:!0},value:{type:Object},__formElements:{type:Object},__formElementsArray:{type:Array}}}static get tag(){return"simple-fields-lite"}constructor(){super(),this.disableAutofocus=!1,this.language="en",this.resources={},this.schemaConversion,this.__formElements={},this.__formElementsArray=[],this.schema={},this.value={},setTimeout(()=>{new Promise((res,rej)=>_require.default(["../../../@polymer/iron-icons/iron-icons.js"],res,rej)),new Promise((res,rej)=>_require.default(["../../../@polymer/iron-icons/editor-icons.js"],res,rej)),new Promise((res,rej)=>_require.default(["../../../@polymer/paper-icon-button/paper-icon-button.js"],res,rej))},0)}disconnectedCallback(){this._clearForm(),super.disconnectedCallback()}updated(changedProperties){changedProperties.forEach((oldValue,propName)=>{"error"===propName&&this.error!==oldValue&&this._errorChanged(),["schema","schemaConversion"].includes(propName)&&this._schemaChanged(this.schema,oldValue),"value"===propName&&this._valueChanged(this.value,oldValue)})}get formElements(){return this.__formElements}get formElementsArray(){return this.__formElementsArray}get schemaConversion(){return this.elementizer||{defaultSettings:{element:"input",attributes:{type:"text"},properties:{minLength:"minlength",maxLength:"maxlength"}},type:{array:{defaultSettings:{element:"simple-fields-array",invalidProperty:"invalid",noWrap:!0,descriptionProperty:"description",child:{element:"simple-fields-array-item",noWrap:!0,descriptionProperty:"description",properties:{previewBy:"previewBy"}}}},boolean:{defaultSettings:{element:"input",valueProperty:"checked",valueChangedProperty:"click",attributes:{type:"checkbox",value:!1}}},file:{defaultSettings:{element:"input",attributes:{type:"url"}}},integer:{defaultSettings:{element:"input",attributes:{autofocus:!0,step:1,type:"number"},properties:{minimum:"min",maximum:"max",multipleOf:"step"}}},markup:{defaultSettings:{element:"textarea"}},number:{defaultSettings:{element:"input",attributes:{autofocus:!0,type:"number"},properties:{minimum:"min",maximum:"max",multipleOf:"step"}}},object:{defaultSettings:{element:"simple-fields-fieldset",noWrap:!0,descriptionProperty:"description"}},string:{format:{"date-time":{defaultSettings:{element:"input",attributes:{autofocus:!0,type:"datetime-local"}}},time:{defaultSettings:{element:"input",attributes:{autofocus:!0,type:"time"}}},date:{defaultSettings:{element:"input",attributes:{autofocus:!0,type:"date"}}},email:{defaultSettings:{element:"input",attributes:{autofocus:!0,type:"email"}}},uri:{defaultSettings:{element:"input",attributes:{autofocus:!0,type:"url"}}}}}}}}get valid(){return!this.error||0===Object.keys(this.error==={}).length}updateSchema(){this._formFieldsChanged()}rebuildForm(){this._clearForm(),this._addToForm();let firstField=!!(this.__formElementsArray&&this.__formElementsArray[0]&&this.__formElementsArray[0].field)&&this.__formElementsArray[0].field;firstField&&(firstField.autofocus=!this.disableAutofocus)}_addToForm(schema=this.schema,target=this,prefix="",config){let schemaProps=schema.properties,required=schema.required;Object.keys(schemaProps||{}).forEach(key=>{let schemaProp=schemaProps[key],data=config||this._convertSchema(schemaProp);if(data&&data.element){let id=`${prefix}${key}`,element=document.createElement(data.element),wrapper=schemaProp.properties||schemaProp.items||schemaProp.noWrap||data.noWrap?element:document.createElement("simple-fields-container"),value=this._getValue(`${prefix}${key}`),label=schemaProp.label||schemaProp.title||schemaProp.description||key,desc=schemaProp.description&&(schemaProp.label||schemaProp.title)?schemaProp.description:void 0,errorEvent=(schemaProp.onValueChanged,schemaProp.onErrorChanged);data.labelSlot=schema.labelSlot||data.labelSlot,data.descriptionSlot=schema.descriptionSlot||data.descriptionSlot,data.errorMessageSlot=schema.errorMessageSlot||data.errorMessageSlot,data.valueSlot=schema.valueSlot||data.valueSlot,data.labelProperty=schema.labelProperty||data.labelProperty||"label",data.descriptionProperty=schema.descriptionProperty||data.descriptionProperty||"description",data.valueProperty=schema.valueProperty||data.valueProperty||"value",data.setValueProperty=schema.setValueProperty||data.setValueProperty||data.valueProperty,data.valueChangedProperty=schema.valueChangedProperty||data.valueChangedProperty||`${data.valueProperty}-changed`,data.errorProperty=schema.errorProperty||data.errorProperty||"error",data.errorChangedProperty=schema.errorChangedProperty||data.errorChangedProperty||`${data.errorProperty}-changed`,data.errorMessageProperty=schema.errorMessageProperty||data.errorMessageProperty||"errorMessage",element.resources=this.resources,element.id=id,element.setAttribute("name",id),element.setAttribute("language",this.language),schemaProp.options&&(element.options=schemaProp.options),schemaProp.itemsList&&(element.itemsList=schemaProp.itemsList),required&&required.includes(key)&&element.setAttribute("required",!0),schemaProp.disabled&&(element.disabled=!0,wrapper.disabled=!0),schemaProp.hidden&&(element.hidden=!0,wrapper.hidden=!0),schemaProp.readonly&&(element.hidden=!0,wrapper.hidden=!0),this._configElement(wrapper,label,data.labelProperty,data.labelSlot),this._configElement(wrapper,desc,data.descriptionProperty,data.descriptionSlot),Object.keys(data.attributes||{}).forEach(attr=>{void 0!==typeof data.attributes[attr]&&null!==data.attributes[attr]&&element.setAttribute(attr,data.attributes[attr])}),Object.keys(data.properties||{}).forEach(prop=>{data.properties[prop]&&schemaProp[prop]&&(element[data.properties[prop]]=schemaProp[prop])}),Object.keys(data.slots||{}).forEach(slot=>{data.slots[slot]&&schemaProp[data.slots[slot]]&&data.slots[slot].split(/[\s,]/).forEach(field=>{let span=document.createElement("span");span.slot=slot,span.innerHTML=schemaProp[field],element.appendChild(span)})}),target.slots&&target.slots[key]&&(wrapper.slot=target.slots[key]),target.appendChild(wrapper),"array"===schemaProp.type?this._addArrayItems(value,data.child,schemaProp,element):schemaProp.properties?this._addToForm(schemaProp,element,`${element.id}.`,data.child):(element!==wrapper&&(element.slot="field",wrapper.appendChild(element)),void 0===value&&"boolean"!==schemaProp.type||this._configElement(element,value,data.setValueProperty,data.valueSlot),element.addEventListener(data.valueChangedProperty,e=>this._handleChange(element,data.valueProperty,e)),wrapper.addEventListener(data.errorChangedProperty,e=>{let error=this._deepClone(this.error||{});wrapper[data.errorProperty]?error[id]=wrapper[data.errorMessageProperty]||"":error&&error[id]&&delete error[id],this.error=error,errorEvent&&errorEvent(e)})),this.__formElementsArray.push({id:id,field:wrapper,data:data}),this.__formElements[id]={element:element,field:wrapper}}})}_configElement(target,value,propName,slotName=!1){if(slotName){let span=document.createElement("span");span.slot=slotName,value&&(span.innerHTML=value),target&&target.querySelectorAll(`[slot=${slotName}]`).forEach(el=>el.remove()),target.appendChild(span)}else target[propName]=value}_insertArrayItem(schema,previewBy,element,parent,value,index){let items=this._getValue(parent.name),length=items?items.length:0;items||this._setValue(parent.name,[]),index=index||0===index?index:length;let subschema={properties:{}};subschema.properties[index]=this._addArrayItem(index,schema,previewBy),this._setValue(`${parent.name}.${index}`,value),this._addToForm(subschema,parent,`${parent.id}.`,element)}_addArrayItems(value,element,schema,parent){let propNames=Object.keys(schema.items.properties||{}),previewBy=schema.previewBy||(propNames.length>0?[propNames[0]]:void 0);(value=value||[]).forEach((item,i)=>{this._insertArrayItem(schema,previewBy,element,parent,item,i)}),parent.addEventListener("add",e=>{this._insertArrayItem(schema,previewBy,element,parent,{})}),parent.addEventListener("remove",e=>{let id=e.detail.id,vals=this._getValue(parent.name)||[],index=id.replace(`${parent.name}.`,"");vals.splice(parseInt(index),1),this.__formElementsArray=this.__formElementsArray.filter(field=>0===field.id.indexOf(parent.name)),parent.innerHTML="",vals.forEach((item,i)=>this._insertArrayItem(schema,previewBy,element,parent,item,i)),this._setValue(`${parent.name}`,vals),parent.focus(parseInt(index)-1)})}_addArrayItem(counter,schema,previewBy){let item=this._deepClone(schema.items);return item.label=`${parseInt(counter)+1}`,item.previewBy=previewBy,item}_clearForm(){this.querySelectorAll("*").forEach(child=>child.remove()),this.__formElementsArray=[]}_convertSchema(property,conversion=this.schemaConversion,settings){let propKeys=Object.keys(property||{}),convKeys=Object.keys(conversion).filter(key=>propKeys.includes(key));return conversion.defaultSettings&&(settings=this._deepClone(conversion.defaultSettings)),convKeys.forEach(key=>{let val=property[key],convData=conversion?conversion[key]:void 0,convVal=convData?Array.isArray(val)?convData[val[0]]:convData[val]:void 0;convVal&&(settings=this._convertSchema(property,convVal,settings))}),settings}_deepClone(o){return JSON.parse(JSON.stringify(o))}_errorChanged(){this.formElementsArray.forEach(field=>{let data=field.data||{},el=field.field;if(field.id&&el&&this.error){let message=this.error[field.id]||!1,error=!!this.error[field.id];error||Object.keys(this.error||{}).forEach(key=>{key.match(field.id)&&(error=!0)}),this._configElement(field.field,message,data.errorMessageProperty,data.errorMessageSlot),field.field[data.errorProperty]=error,field.field.setAttribute("aria-invalid",error)}})}_fireValueChanged(){this.dispatchEvent(new CustomEvent("value-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}_formFieldsChanged(e){this.dispatchEvent(new CustomEvent("fields-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}_getValue(propName){let path=propName.split("."),pointer=this.value;return path.forEach(prop=>{pointer=pointer&&pointer[prop]?pointer[prop]:void 0}),pointer}_handleChange(element,valueProperty,e){e&&e.stopPropagation&&e.stopPropagation();let id=element.id||element.getAttribute("id"),val=element[valueProperty];this._setValue(id,val),this.dispatchEvent(new CustomEvent(`${id}-value-changed`,{bubbles:!0,cancelable:!0,composed:!0,detail:{id:id,element:element,value:val}})),this._fireValueChanged()}_schemaChanged(newValue,oldValue){newValue&&newValue!==oldValue&&(this.rebuildForm(),this.dispatchEvent(new CustomEvent("schema-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this})))}_setValue(propName,propVal){let oldValue=this._deepClone(this.value),newValue=this.value,props=propName?propName.split("."):[],l=props.length;for(var i=0;i<l-1;i++){let pointer=props[i];newValue[pointer]||(newValue[pointer]={}),newValue=newValue[pointer]}newValue[props[l-1]]=propVal,this._valueChanged(this.value,oldValue)}_valueChanged(newValue,oldValue){newValue&&newValue!==oldValue&&this._fireValueChanged()}}_exports.SimpleFieldsLite=SimpleFieldsLite,window.customElements.define(SimpleFieldsLite.tag,SimpleFieldsLite)}));